!function(r,e){e.orderMan=dis.subscribe("orders_management_man"),r("tbody").on("click",".view-detail",function(r){var e={order_id:r.currentTarget.getAttribute("data-order_id")};return window.dis.trigger("man_view_order",e),!1}),r("tbody").on("click",".view-logs",function(r){var e={order_id:r.currentTarget.getAttribute("data-order_id")};return window.dis.trigger("view_logs",e),!1}),privateChannel.bind("view_order_logs",function(e){var t,o={},d="",s=e.accounts;for(orderProcessings=e.order_processings,statusMap=["","VIEW ORDER","SENT EMAIL to customer","SENT TICKETS to customer"],console.log(e),t=0;t<s.length;t++)o[s[t].id]=s[t].username;for(t=0;t<orderProcessings.length;t++)d=d+"<li>"+o[orderProcessings[t].account_id]+" "+statusMap[orderProcessings[t].status]+" at "+new Date(orderProcessings[t].created_at).toLocaleString()+"</li>";r(".logs").html(r(d)),r.magnificPopup.open({items:{src:".action-logs",type:"inline"},callbacks:{beforeClose:function(){}}})}),orderMan.bind("order_emp_view_order",function(e){var t=r(".order_id_"+e.id+" .order_status");t.removeClass().addClass("order_status viewed").html("VIEWED")}),orderMan.bind("order_emp_send_email",function(e){var t=r(".order_id_"+e.id+" .order_status");t.removeClass().addClass("order_status sent-email").html("SENT EMAIL")}),orderMan.bind("order_emp_send_ticket",function(e){var t=r(".order_id_"+e.id+" .order_status");t.removeClass().addClass("order_status sent-tickets").html("SENT TICKETS")}),orderMan.bind("new_request",function(e){var t,o=r("table").data("footable"),d=["<span class='order_status new'>NEW</span>","<span class='order_status view-order'>VIEW ORDER</span>","<span class='order_status sent-email'>SENT EMAIL</span>","<span class='order_status sent-tickets'>SENT TICKETS</span>"];t=r("<tr><td>"+e.customer.name+"</td><td>"+e.order.from+"</td><td>"+e.order.to+"</td><td>"+e.order.depart_date+"</td><td>"+(e.order.return_date||"&nbsp;")+"</td><td>"+new Date(e.order.created_at).toLocaleString()+"</td><td>"+d[e.order.status]+'</td><td><button class="view-detail btn btn-primary btn-sm" href="#" data-order_id="'+e.order.id+'">View detail</button></td><td><button class="view-logs btn btn-primary btn-sm" href="#" data-order_id="'+e.order.id+'">View logs</button></td><td>'),o.appendRow(t)}),r(".footable").bind("footable_breakpoint",function(){r(".footable").trigger("footable_expand_first_row")}).footable()}(jQuery,window);